add lock to sql aggregate function for usage statistic