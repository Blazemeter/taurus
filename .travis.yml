sudo: false
language: python
cache: pip  # use caching for pip's packages to speed up builds

branches:
  only:
  - master

os: linux

python:
- "2.7"
- "3.4"
- "3.5"
- "3.6"

env:
  global:
  - PIP=pip
  - GENERAL_EXCLUDE="--exclude-dir=tests/resources --exclude-dir=tests/ci"

matrix:
  include:
  - os: osx
    language: generic
    env:
    - PIP=pip2
    - OSX_PIP_OPT="--user"
    - RVM_KEY="409B6B1796C275462A1703113804BB82D39DC0E3"
    - OSX_EXCLUDE="--exclude-test=tests.modules.selenium.test_csharp"

addons:
  firefox: "54.0"
  apt:
    packages:
      - oracle-java8-set-default
      - mono-complete

before_install:
- export DISPLAY=:99.0
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then sh -e /etc/init.d/xvfb start; fi
- (if [ "$TRAVIS_OS_NAME" = "osx" ]; then sudo xvfb :99; fi)&

install:
- |
  if [ "$TRAVIS_OS_NAME" = "linux" ]; then
    mono --version
  else
    gpg --keyserver hkp://keys.gnupg.net --recv-keys $RVM_KEY && rvm get stable
  fi
- nvm install 6.11
- nvm use 6.11
- gem install rspec
- $PIP install $OSX_PIP_OPT --upgrade pip
- $PIP install $OSX_PIP_OPT -r requirements.txt
- $PIP install $OSX_PIP_OPT -r tests/ci/requirements.txt

script:
- coverage run --source=. python -m nose tests -v $GENERAL_EXCLUDE $OSX_EXCLUDE

after_success:
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then coverage report -m; fi
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then codecov; fi



